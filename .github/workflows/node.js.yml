# .github/workflows/node.js.yml

name: CI for Backend and Frontend

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  # --- TRABAJO PARA EL BACKEND ---
  backend-ci:
    name: Backend CI
    runs-on: ubuntu-latest

    # Directorio de trabajo por defecto para todos los pasos de este job
    defaults:
      run:
        working-directory: ./backend

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Use Node.js 20.x
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        # Le decimos a la caché dónde encontrar el lockfile del backend
        cache-dependency-path: backend/package-lock.json

    - name: Install backend dependencies
      run: npm ci

    - name: Generate Prisma Client
      run: npx prisma generate

    - name: Run backend linter
      run: npm run lint


  # --- TRABAJO PARA EL FRONTEND ---
  frontend-ci:
    name: Frontend CI
    runs-on: ubuntu-latest

    # Directorio de trabajo por defecto para todos los pasos de este job
    defaults:
      run:
        working-directory: ./frontend

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Use Node.js 20.x
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        # Le decimos a la caché dónde encontrar el lockfile del frontend
        cache-dependency-path: frontend/package-lock.json

    - name: Install frontend dependencies
      run: npm ci

    - name: Run frontend linter
      run: npm run lint

    - name: Build frontend
      run: npm run build --if-present
